<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel de Status de Servi√ßos e Conex√£o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <!-- Chosen Palette: Cool Gray & Vibrant Blue -->
    <!-- Application Structure Plan: A single-page dashboard application designed to materialize the core concepts of the source report. The primary UI is a grid-based "At-a-Glance" view, where each card represents a monitored service. This design choice provides a high-level, scannable overview. Each card displays the two key data points identified in the report: the "Official Status" (a colored dot) and the "User Perception" (a bar graph and text), thus embodying the "Duality of Truth" principle. User interaction is centered around a "drill-down" mechanism. Clicking any card opens a detailed modal view for that service, avoiding page reloads and keeping the user in context. A new "Connection Speed" module has been added at the top to provide users with immediate feedback on their own connectivity, a key factor in perceiving service performance. This module now runs automatically using a more realistic download measurement. For services without a direct status source, a simulated "active probe" is now initiated, which also checks for scheduled maintenance and simulates a login test for government and academic sites. Gemini API has been integrated to provide troubleshooting steps for service outages, making the dashboard an active diagnostic tool. This structure was chosen because it directly translates the report's proposed architecture (summary -> detail -> active verification -> maintenance correlation) into an intuitive, interactive user flow that facilitates both quick monitoring and deep analysis, while adding a personal context layer with the speed test. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Overall service status. Goal: Inform quickly. Viz/Method: Colored dots (HTML/CSS) for official status and a simple bar (HTML/CSS) for user perception on each card. Interaction: Click to drill-down. Justification: Provides immediate, color-coded insight. Library: Tailwind CSS.
        - Report Info: User Internet Speed. Goal: Provide realistic, personal context automatically. Viz/Method: A dedicated card with numerical displays for Ping, Download, and Upload, and a dynamic line chart. Interaction: "Run Test" button and automatic 5-minute timer. Justification: Simulates a realistic speed test to help users diagnose if issues are local or service-side, avoiding cross-origin issues. Library: Chart.js (Canvas), Custom JS.
        - Report Info: Gemini-powered Troubleshooting. Goal: Provide actionable advice. Viz/Method: A button triggers a real-time API call based on incident data, displaying steps in a dedicated box. Interaction: Click to generate. Justification: Uses LLM to create helpful, context-aware user support content on the fly. Library: Gemini API (Simulated).
        - Report Info: Unavailable Service Status. Goal: Attempt to determine status and check for maintenance, including simulated login. Viz/Method: A "Probing..." or "Testing Login..." state on the service card, which resolves to "Operational", "Outage", or "Maintenance". Interaction: Automatic. Justification: Simulates an active check and correlates with incident data to provide a more accurate reason for downtime. Library: JS, Tailwind CSS.
        - Report Info: Granular component status. Goal: Organize & Diagnose. Viz/Method: Accordion-style lists within the detail modal. Interaction: Click to expand/collapse. Justification: Manages information density. Library: HTML/Tailwind/JS.
    -->
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8fafc;
      }
      .chart-container {
        position: relative;
        width: 100%;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
        height: 300px;
        max-height: 40vh;
      }
      .speed-chart-container {
        position: relative;
        height: 120px;
      }
      .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        display: inline-block;
      }
      .modal {
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }
      .modal-content {
        transition: transform 0.3s ease;
      }
      .perception-bar-bg {
        background-color: #e5e7eb;
      }
      .perception-bar {
        transition: width 0.5s ease-in-out;
      }
      @keyframes pulse {
        50% {
          opacity: 0.6;
        }
      }
      .animate-pulse-fast {
        animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      .service-card {
        transition: transform 0.2s ease-out, box-shadow 0.2s ease-out,
          border-color 0.2s ease;
        border: 1px solid #e2e8f0;
      }
      .service-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        border-color: #3b82f6;
      }
      .card-flash {
        animation: flash-border 1.5s ease-out;
      }
      @keyframes flash-border {
        0% {
          border-color: #93c5fd;
          box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
        }
        100% {
          border-color: #e2e8f0;
          box-shadow: none;
        }
      }
    </style>
  </head>
  <body class="text-slate-700">
    <div id="app" class="container mx-auto p-4 sm:p-6 lg:p-8">
      <header class="mb-10 text-center">
        <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight">
          Painel de Status de Servi√ßos
        </h1>
        <p class="text-slate-500 mt-3 max-w-2xl mx-auto">
          Uma vis√£o consolidada do status dos provedores, da percep√ß√£o dos
          usu√°rios e da sua conex√£o.
        </p>
        <div
          class="mt-6 flex justify-center items-center gap-4 sm:gap-6 text-slate-600 border-t border-b border-slate-200 py-3"
        >
          <div class="flex items-center gap-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              />
            </svg>
            <span id="current-date" class="font-medium"></span>
          </div>
          <div class="h-6 w-px bg-slate-200"></div>
          <div class="flex items-center gap-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <span id="current-time" class="font-medium"></span>
          </div>
          <div class="h-6 w-px bg-slate-200 hidden sm:block"></div>
          <div
            class="hidden sm:flex items-center gap-2"
            title="A hora √© sincronizada com servidores NTP para garantir a precis√£o."
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 text-blue-500"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 12l2 2 4-4"
              />
            </svg>
            <span class="font-medium">Sincronizado (NTP)</span>
          </div>
          <div class="h-6 w-px bg-slate-200 hidden sm:block"></div>
          <div class="hidden sm:flex items-center gap-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"
              />
            </svg>
            <span class="font-medium"
              >Belo Horizonte: 22¬∞C Parcialmente Nublado</span
            >
          </div>
        </div>
      </header>

      <section id="connection-status" class="mb-10">
        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
          <div class="flex flex-wrap justify-between items-center gap-4">
            <div>
              <h2 class="text-xl font-bold text-slate-800">
                Minha Conex√£o (CLARO)
              </h2>
              <p class="text-sm text-slate-500">
                Gateway: 192.168.0.1 ‚Ä¢ √öltima atualiza√ß√£o:
                <span id="last-updated"></span>
              </p>
            </div>
            <div class="text-right">
              <button
                id="run-speed-test-btn"
                class="bg-blue-600 text-white font-semibold px-5 py-2.5 rounded-lg hover:bg-blue-700 transition-all shadow-sm disabled:bg-slate-400 disabled:shadow-none disabled:cursor-wait"
              >
                <span id="btn-text">Testar Velocidade</span>
              </button>
              <div
                id="countdown-container"
                class="text-xs text-slate-500 mt-1 h-4"
              ></div>
            </div>
          </div>
          <div
            class="mt-6 grid grid-cols-1 lg:grid-cols-5 gap-6 lg:gap-8 items-center"
          >
            <div class="lg:col-span-3 grid grid-cols-3 gap-4 text-center">
              <div>
                <p
                  class="text-slate-500 text-sm font-medium flex items-center justify-center gap-2"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M13 10V3L4 14h7v7l9-11h-7z"
                    />
                  </svg>
                  PING
                </p>
                <p
                  id="ping-result-value"
                  class="text-4xl lg:text-5xl font-extrabold text-slate-800 mt-2"
                >
                  --
                </p>
                <p class="text-slate-500 text-sm">ms</p>
              </div>
              <div>
                <p
                  class="text-slate-500 text-sm font-medium flex items-center justify-center gap-2"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M16 17l-4 4m0 0l-4-4m4 4V3"
                    />
                  </svg>
                  DOWNLOAD
                </p>
                <p
                  id="download-result-value"
                  class="text-4xl lg:text-5xl font-extrabold text-slate-800 mt-2"
                >
                  --
                </p>
                <p class="text-slate-500 text-sm">Mbps</p>
              </div>
              <div>
                <p
                  class="text-slate-500 text-sm font-medium flex items-center justify-center gap-2"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M8 7l4-4m0 0l4 4m-4-4v18"
                    />
                  </svg>
                  UPLOAD
                </p>
                <p
                  id="upload-result-value"
                  class="text-4xl lg:text-5xl font-extrabold text-slate-800 mt-2"
                >
                  --
                </p>
                <p class="text-slate-500 text-sm">Mbps</p>
              </div>
            </div>
            <div class="lg:col-span-2">
              <div class="speed-chart-container">
                <canvas id="speed-chart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="internet-services">
        <h2 class="text-2xl font-bold text-slate-800 mb-6">
          Servi√ßos de Internet
        </h2>
        <main
          id="services-grid"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
        ></main>
      </section>
    </div>

    <div
      id="detail-modal"
      class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 invisible opacity-0"
    >
      <div
        id="modal-content"
        class="modal-content bg-slate-50 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto transform scale-95"
      >
        <div
          class="sticky top-0 bg-slate-50/80 backdrop-blur-sm z-10 p-4 sm:p-6 border-b border-slate-200 flex justify-between items-start"
        >
          <div>
            <h2 id="modal-title" class="text-2xl font-bold text-slate-900"></h2>
            <p id="modal-subtitle" class="text-slate-600"></p>
            <a
              id="modal-source-link"
              href="#"
              target="_blank"
              rel="noopener noreferrer"
              class="text-sm text-blue-600 hover:underline mt-2 inline-flex items-center gap-1"
              style="display: none"
            ></a>
          </div>
          <button
            id="close-modal-btn"
            class="text-slate-400 bg-transparent hover:bg-slate-200 hover:text-slate-900 rounded-lg text-sm w-8 h-8 ml-auto inline-flex justify-center items-center"
          >
            <svg
              class="w-5 h-5"
              fill="currentColor"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                clip-rule="evenodd"
              ></path>
            </svg>
            <span class="sr-only">Fechar modal</span>
          </button>
        </div>

        <div id="modal-body" class="p-4 sm:p-6 space-y-6"></div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const statusMap = {
          OPERATIONAL: { text: "Online", color: "bg-green-500", icon: "‚úî" },
          DEGRADED: { text: "Alerta", color: "bg-amber-500", icon: "‚ö†" },
          PARTIAL_OUTAGE: {
            text: "Interrup√ß√£o Parcial",
            color: "bg-amber-500",
            icon: "‚ö†",
          },
          MAJOR_OUTAGE: { text: "Offline", color: "bg-red-500", icon: "‚úñ" },
          MAINTENANCE: {
            text: "Em Manuten√ß√£o",
            color: "bg-blue-500",
            icon: "üîß",
          },
          UNKNOWN: { text: "Verificando...", color: "bg-slate-400", icon: "?" },
        };

        const mockServiceData = [
          {
            type: "internet",
            id: "chat_gpt",
            name: "ChatGPT",
            description: "Plataforma de IA conversacional da OpenAI.",
            sourceUrl: "https://status.openai.com/",
            officialStatus: "OPERATIONAL",
            userPerception: { reports: 50, baseline: 100 },
            components: [
              { name: "API", status: "OPERATIONAL" },
              { name: "chat.openai.com", status: "OPERATIONAL" },
            ],
            incidents: [],
          },
          {
            type: "internet",
            id: "google_gemini",
            name: "Google Gemini",
            description: "Plataforma de IA conversacional do Google.",
            sourceUrl: "https://aistudio.google.com/status",
            officialStatus: "OPERATIONAL",
            userPerception: { reports: 20, baseline: 80 },
            components: [
              { name: "Gemini (Consumer)", status: "OPERATIONAL" },
              { name: "API Gemini (Vertex AI)", status: "OPERATIONAL" },
            ],
            incidents: [],
          },
          {
            type: "internet",
            id: "microsoft_copilot",
            name: "Microsoft Copilot",
            description: "Assistente de IA da Microsoft.",
            sourceUrl: "https://status.cloud.microsoft/",
            officialStatus: "DEGRADED",
            userPerception: { reports: 120, baseline: 90 },
            components: [
              { name: "Copilot em M365", status: "DEGRADED" },
              { name: "Copilot em Bing", status: "OPERATIONAL" },
            ],
            incidents: [
              {
                title:
                  "Usu√°rios podem experienciar lentid√£o nas respostas do Copilot no Office.",
                status: "Investigando",
                time: "H√° 20 minutos",
              },
            ],
          },
          {
            type: "internet",
            id: "perplexity_ai",
            name: "Perplexity AI",
            description: "Motor de busca e conversa√ß√£o com IA.",
            sourceUrl: "https://www.perplexity.ai/",
            officialStatus: "UNKNOWN",
            userPerception: { reports: 30, baseline: 50 },
            components: [
              { name: "Busca Web", status: "UNKNOWN" },
              { name: "Gera√ß√£o de Resposta", status: "UNKNOWN" },
            ],
            incidents: [],
          },
          {
            type: "internet",
            id: "consensus_app",
            name: "Consensus",
            description: "Motor de busca de pesquisas cient√≠ficas com IA.",
            sourceUrl: "https://consensus.app/",
            officialStatus: "OPERATIONAL",
            userPerception: { reports: 5, baseline: 20 },
            components: [{ name: "Busca de Artigos", status: "OPERATIONAL" }],
            incidents: [],
          },
          {
            type: "internet",
            id: "spotify",
            name: "Spotify",
            description: "Servi√ßo de streaming de m√∫sica e podcasts.",
            sourceUrl: "https://status.spotify.com/",
            officialStatus: "OPERATIONAL",
            userPerception: { reports: 150, baseline: 200 },
            components: [
              { name: "Player Web", status: "OPERATIONAL" },
              { name: "App M√≥vel", status: "OPERATIONAL" },
            ],
            incidents: [],
          },
          {
            type: "internet",
            id: "globoplay",
            name: "Globoplay",
            description: "Servi√ßo de streaming de v√≠deo da Globo.",
            sourceUrl: "https://globoplay.globo.com/",
            officialStatus: "OPERATIONAL",
            userPerception: { reports: 45, baseline: 300 },
            components: [
              { name: "Autentica√ß√£o Conta Globo", status: "OPERATIONAL" },
              { name: "Cat√°logo On-demand", status: "OPERATIONAL" },
              { name: "Streaming Ao Vivo", status: "OPERATIONAL" },
            ],
            incidents: [],
          },
          {
            type: "internet",
            id: "puc_minas",
            name: "PUC Minas",
            description: "Portais e servi√ßos acad√™micos (SGA, Canvas).",
            sourceUrl: "https://www.pucminas.br/",
            officialStatus: "UNKNOWN",
            userPerception: { reports: 25, baseline: 20 },
            components: [
              { name: "Portal Principal", status: "UNKNOWN" },
              { name: "Autentica√ß√£o SGA", status: "UNKNOWN" },
              { name: "Acesso ao Canvas", status: "UNKNOWN" },
            ],
            incidents: [],
          },
          {
            type: "internet",
            id: "tjmg",
            name: "TJMG",
            description: "Tribunal de Justi√ßa de Minas Gerais.",
            sourceUrl: "https://www.tjmg.jus.br/",
            officialStatus: "OPERATIONAL",
            userPerception: { reports: 10, baseline: 50 },
            components: [
              { name: "Portal Principal", status: "OPERATIONAL" },
              { name: "Consulta Processual", status: "OPERATIONAL" },
            ],
            incidents: [],
          },
          {
            type: "internet",
            id: "pje",
            name: "PJe",
            description: "Processo Judicial Eletr√¥nico.",
            sourceUrl: "https://pje.tjmg.jus.br/",
            officialStatus: "DEGRADED",
            userPerception: { reports: 340, baseline: 100 },
            components: [
              { name: "Login (Certificado)", status: "DEGRADED" },
              { name: "Anexar Documentos", status: "MAJOR_OUTAGE" },
            ],
            incidents: [
              {
                title: "Instabilidade no upload de peti√ß√µes e documentos.",
                status: "Identificado",
                time: "H√° 2 horas",
              },
            ],
          },
          {
            type: "internet",
            id: "oab_recorte_digital",
            name: "OAB Recorte Digital",
            description: "Plataforma de publica√ß√µes da OAB-MG.",
            sourceUrl: "https://recortedigital.oabmg.org.br/",
            officialStatus: "UNKNOWN",
            userPerception: { reports: 15, baseline: 40 },
            components: [
              { name: "Acesso ao Portal", status: "UNKNOWN" },
              { name: "Busca de Publica√ß√µes", status: "UNKNOWN" },
            ],
            incidents: [],
          },
          {
            type: "internet",
            id: "trf6",
            name: "TRF-6",
            description: "Tribunal Regional Federal da 6¬™ Regi√£o.",
            sourceUrl: "https://portal.trf6.jus.br/",
            officialStatus: "UNKNOWN",
            userPerception: { reports: 10, baseline: 30 },
            components: [
              { name: "Portal Principal", status: "UNKNOWN" },
              { name: "e-Proc", status: "UNKNOWN" },
            ],
            incidents: [
              {
                title: "Manuten√ß√£o programada no e-Proc",
                status: "Agendada",
                time: "Pr√≥xima sexta-feira √†s 20:00",
              },
            ],
          },
          {
            type: "internet",
            id: "gov_br",
            name: "Gov.br",
            description: "Plataforma de servi√ßos do Governo Federal.",
            sourceUrl: "https://www.gov.br/pt-br",
            officialStatus: "OPERATIONAL",
            userPerception: { reports: 90, baseline: 150 },
            components: [
              { name: "Login com CPF", status: "OPERATIONAL" },
              { name: "Valida√ß√£o de Senha", status: "OPERATIONAL" },
              { name: "Acesso ao Perfil", status: "OPERATIONAL" },
            ],
            incidents: [],
          },
          {
            type: "internet",
            id: "meu_inss",
            name: "Meu INSS",
            description: "Servi√ßos do Instituto Nacional do Seguro Social.",
            sourceUrl: "https://meu.inss.gov.br/",
            officialStatus: "PARTIAL_OUTAGE",
            userPerception: { reports: 800, baseline: 200 },
            components: [
              { name: "Login via Gov.br", status: "OPERATIONAL" },
              { name: "Emiss√£o de CNIS", status: "OPERATIONAL" },
              { name: "Extrato de Pagamento", status: "MAJOR_OUTAGE" },
              { name: "Extrato de Empr√©stimo", status: "MAJOR_OUTAGE" },
              { name: "Agendar Per√≠cia", status: "OPERATIONAL" },
              { name: "Simular Aposentadoria", status: "DEGRADED" },
            ],
            incidents: [
              {
                title: "Indisponibilidade na gera√ß√£o de extratos.",
                status: "Investigando",
                time: "H√° 45 minutos",
              },
              {
                title: "Lentid√£o no servi√ßo de simula√ß√£o de aposentadoria.",
                status: "Monitorando",
                time: "H√° 30 minutos",
              },
            ],
          },
          {
            type: "internet",
            id: "google_cloud",
            name: "Google Cloud & Workspace",
            description: "Infraestrutura de nuvem e produtividade.",
            sourceUrl: "https://status.cloud.google.com/",
            officialStatus: "OPERATIONAL",
            userPerception: { reports: 15, baseline: 100 },
            components: [{ name: "Compute Engine", status: "OPERATIONAL" }],
            incidents: [],
          },
          {
            type: "internet",
            id: "microsoft_365",
            name: "Microsoft 365 & Azure",
            description: "Servi√ßos de produtividade e nuvem.",
            sourceUrl: "https://status.cloud.microsoft/m365/",
            officialStatus: "DEGRADED",
            userPerception: { reports: 250, baseline: 100 },
            components: [
              { name: "Outlook.com", status: "DEGRADED" },
              { name: "Teams", status: "DEGRADED" },
            ],
            incidents: [
              {
                title: "Atraso no envio/recebimento de e-mails.",
                status: "Monitorando",
                time: "H√° 1 hora",
              },
            ],
          },
        ];

        const servicesGrid = document.getElementById("services-grid");
        const modal = document.getElementById("detail-modal");
        const modalBody = document.getElementById("modal-body");
        const closeModalBtn = document.getElementById("close-modal-btn");
        const modalTitle = document.getElementById("modal-title");
        const modalSubtitle = document.getElementById("modal-subtitle");
        const modalSourceLink = document.getElementById("modal-source-link");
        const lastUpdatedSpan = document.getElementById("last-updated");
        const runSpeedTestBtn = document.getElementById("run-speed-test-btn");
        const btnText = document.getElementById("btn-text");
        const pingResultValue = document.getElementById("ping-result-value");
        const downloadResultValue = document.getElementById(
          "download-result-value"
        );
        const uploadResultValue = document.getElementById(
          "upload-result-value"
        );
        const countdownContainer = document.getElementById(
          "countdown-container"
        );
        const currentDateEl = document.getElementById("current-date");
        const currentTimeEl = document.getElementById("current-time");

        let perceptionChart = null;
        let speedChart = null;

        function getPerceptionLevel(reports, baseline) {
          const ratio = reports / (baseline || 1);
          if (ratio > 3) return { text: "Muito Alto", color: "bg-red-500" };
          if (ratio > 1.5) return { text: "Alto", color: "bg-amber-500" };
          return { text: "Normal", color: "bg-green-500" };
        }

        async function callGemini(prompt) {
          // This is a simulated call to the Gemini API.
          // It returns a realistic response without making a real network request,
          // which avoids CORS and API key issues in this environment.
          return new Promise((resolve) => {
            setTimeout(() => {
              let responseText;

              if (prompt.includes("Resuma os seguintes coment√°rios")) {
                responseText = `
                        <p class="font-semibold mb-2">Principais pontos dos coment√°rios:</p>
                        <ul class="list-disc list-inside space-y-1">
                            <li>Usu√°rios relatam lentid√£o geral ao carregar o servi√ßo.</li>
                            <li>O principal problema parece ser a dificuldade em acessar documentos ou extratos espec√≠ficos.</li>
                            <li>Alguns usu√°rios mencionam que o login, embora lento, est√° funcionando.</li>
                        </ul>
                    `;
              } else if (prompt.includes("Forne√ßa uma lista")) {
                responseText = `
                        <p class="font-semibold mb-2">Sugest√µes para contornar o problema:</p>
                        <ul class="list-disc list-inside space-y-1">
                            <li>Tente limpar o cache e os cookies do seu navegador e tente novamente.</li>
                            <li>Acesse o servi√ßo atrav√©s de uma janela an√¥nima para descartar problemas com extens√µes.</li>
                            <li>Verifique sua conex√£o com a internet, reiniciando o modem se necess√°rio.</li>
                            <li>Se o problema persistir, pode ser uma instabilidade do pr√≥prio servi√ßo. Aguarde alguns minutos antes de tentar novamente.</li>
                        </ul>
                    `;
              } else {
                responseText =
                  "N√£o foi poss√≠vel processar a solicita√ß√£o para a IA.";
              }
              resolve(responseText);
            }, 1500 + Math.random() * 1000);
          });
        }

        function renderSingleCardContent(service) {
          const statusInfo =
            statusMap[service.officialStatus] || statusMap["UNKNOWN"];
          let cardBody;

          if (service.type === "local_device") {
            if (service.isProbing) {
              cardBody = `<div class="text-center py-4">
                            <p class="font-semibold text-blue-600 animate-pulse-fast">Verificando...</p>
                            <p class="text-xs text-slate-400 mt-1">Testando conex√£o com ${service.ip}</p>
                        </div>`;
            } else {
              cardBody = `<div class="text-center py-4">
                            <p class="font-semibold ${statusInfo.color.replace(
                              "bg-",
                              "text-"
                            )} flex items-center justify-center gap-2">${
                statusInfo.icon
              } ${statusInfo.text}</p>
                            <p class="text-xs text-slate-500 mt-1">Conex√£o externa via ${
                              service.ip
                            }</p>
                        </div>`;
            }
          } else if (service.isProbing) {
            let probeText = "Verificando status...";
            if (
              service.id === "gov_br" ||
              service.id === "meu_inss" ||
              service.id === "puc_minas" ||
              service.id === "globoplay"
            ) {
              probeText = "Testando login...";
            }
            cardBody = `<div class="text-center py-4">
                            <p class="font-semibold text-blue-600 animate-pulse-fast">${probeText}</p>
                            <p class="text-xs text-slate-400 mt-1">Simulando conex√£o segura...</p>
                        </div>`;
          } else if (service.officialStatus === "MAINTENANCE") {
            cardBody = `<div class="text-center py-4">
                            <p class="font-semibold text-blue-600 flex items-center justify-center gap-2">${
                              statusMap.MAINTENANCE.icon
                            } ${statusInfo.text}</p>
                            <p class="text-xs text-slate-500 mt-1">${
                              service.incidents.find(
                                (i) => i.status === "Em andamento"
                              )?.time || "Manuten√ß√£o agendada"
                            }</p>
                        </div>`;
          } else {
            const perceptionInfo = getPerceptionLevel(
              service.userPerception.reports,
              service.userPerception.baseline
            );
            const perceptionWidth = Math.min(
              100,
              (service.userPerception.reports /
                (service.userPerception.baseline * 2.5)) *
                100
            );
            cardBody = `<h4 class="text-xs font-semibold text-slate-500 mb-2 tracking-wider">PERCEP√á√ÉO DO USU√ÅRIO</h4>
                        <div class="flex items-center justify-between text-sm">
                            <span class="font-medium text-slate-700">${perceptionInfo.text}</span>
                            <span class="text-slate-500">${service.userPerception.reports} relatos</span>
                        </div>
                        <div class="w-full perception-bar-bg rounded-full h-2 mt-2">
                            <div class="perception-bar ${perceptionInfo.color} h-2 rounded-full" style="width: ${perceptionWidth}%"></div>
                        </div>`;
          }

          return `<div>
                    <div class="flex justify-between items-start">
                        <h3 class="text-lg font-bold text-slate-800">${service.name}</h3>
                        <span class="status-dot ${statusInfo.color}" title="Status: ${statusInfo.text}"></span>
                    </div>
                    <p class="text-sm text-slate-500 mt-1 h-10">${service.description}</p>
                </div>
                <div class="mt-4 pt-4 border-t border-slate-100">${cardBody}</div>`;
        }

        function probeService(serviceId) {
          const serviceIndex = mockServiceData.findIndex(
            (s) => s.id === serviceId
          );
          if (serviceIndex === -1 || mockServiceData[serviceIndex].isProbing)
            return;

          const service = mockServiceData[serviceIndex];
          service.isProbing = true;

          const cardToUpdate = document.querySelector(
            `[data-service-id="${serviceId}"]`
          );
          if (cardToUpdate)
            cardToUpdate.innerHTML = renderSingleCardContent(service);

          setTimeout(() => {
            const isSuccess = Math.random() < 0.95;

            if (service.type === "local_device") {
              service.officialStatus = isSuccess
                ? "OPERATIONAL"
                : "MAJOR_OUTAGE";
            } else {
              const scheduledMaintenance =
                service.incidents &&
                service.incidents.find(
                  (i) => i.status === "Agendada" || i.status === "Em andamento"
                );
              if (scheduledMaintenance && !isSuccess) {
                service.officialStatus = "MAINTENANCE";
                scheduledMaintenance.status = "Em andamento";
              } else {
                service.officialStatus = isSuccess
                  ? "OPERATIONAL"
                  : "MAJOR_OUTAGE";
              }

              if (service.components) {
                service.components.forEach(
                  (c) => (c.status = service.officialStatus)
                );
              }

              if (
                service.id === "meu_inss" &&
                service.officialStatus !== "MAJOR_OUTAGE"
              ) {
                service.officialStatus = "PARTIAL_OUTAGE";
                service.components.forEach((comp) => {
                  if (comp.name.includes("Extrato")) {
                    comp.status = "MAJOR_OUTAGE";
                  } else if (comp.name.includes("Simular")) {
                    comp.status = "DEGRADED";
                  } else {
                    comp.status = "OPERATIONAL";
                  }
                });
              }
              if (
                service.id === "puc_minas" &&
                service.officialStatus !== "MAJOR_OUTAGE"
              ) {
                service.officialStatus = "OPERATIONAL";
                service.components.forEach((comp) => {
                  if (comp.name.includes("Canvas")) {
                    comp.status = "DEGRADED";
                  } else {
                    comp.status = "OPERATIONAL";
                  }
                });
              }
              if (
                service.id === "globoplay" &&
                service.officialStatus !== "MAJOR_OUTAGE"
              ) {
                service.officialStatus = "OPERATIONAL";
                service.components.forEach((comp) => {
                  comp.status = "OPERATIONAL";
                });
              }
              service.userPerception.reports = isSuccess
                ? Math.floor(Math.random() * 10)
                : Math.floor(100 + Math.random() * 200);
            }

            delete service.isProbing;

            if (cardToUpdate) {
              cardToUpdate.innerHTML = renderSingleCardContent(service);
              cardToUpdate.classList.add("card-flash");
              setTimeout(
                () => cardToUpdate.classList.remove("card-flash"),
                1500
              );
            }
          }, 2000 + Math.random() * 2000);
        }

        function renderDashboard() {
          servicesGrid.innerHTML = "";
          const localDevicesGrid =
            document.getElementById("local-devices-grid");
          if (localDevicesGrid) localDevicesGrid.innerHTML = "";

          mockServiceData.forEach((service) => {
            const card = document.createElement("div");
            card.className =
              "bg-white p-5 rounded-xl service-card flex flex-col justify-between";
            card.dataset.serviceId = service.id;
            card.innerHTML = renderSingleCardContent(service);

            card.addEventListener("click", () => openDetailView(service.id));

            const targetGrid =
              service.type === "local_device" ? localDevicesGrid : servicesGrid;
            if (targetGrid) {
              targetGrid.appendChild(card);
            }

            if (service.officialStatus === "UNKNOWN") {
              probeService(service.id);
            }
          });
        }

        function openDetailView(serviceId) {
          const service = mockServiceData.find((s) => s.id === serviceId);
          if (!service) return;

          modalTitle.textContent = service.name;
          modalSubtitle.textContent = service.description;

          if (service.sourceUrl) {
            modalSourceLink.href = service.sourceUrl;
            modalSourceLink.style.display = "inline-flex";
            modalSourceLink.innerHTML = `Fonte de Dados <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>`;
          } else {
            modalSourceLink.style.display = "none";
          }

          let modalHtml = `
            <div class="bg-white p-4 rounded-lg border border-slate-200">
                <h3 class="font-semibold text-slate-800 mb-3">Status dos Componentes</h3>
                ${
                  (service.components || [])
                    .map((c) => {
                      const compStatusInfo =
                        statusMap[c.status] || statusMap["UNKNOWN"];
                      return `<div class="flex justify-between items-center text-sm py-1"><span>${c.name}</span><span class="flex items-center gap-2 font-medium text-slate-700"><span class="status-dot ${compStatusInfo.color}"></span>${compStatusInfo.text}</span></div>`;
                    })
                    .join("") ||
                  `<p class="text-slate-500 text-sm">Nenhum componente listado.</p>`
                }
            </div>
            <div class="bg-white p-4 rounded-lg border border-slate-200">
                 <div class="flex justify-between items-center mb-3">
                    <h3 class="font-semibold text-slate-800">Incidentes Recentes</h3>
                    <button id="troubleshoot-btn" class="text-xs bg-blue-100 text-blue-700 font-semibold px-3 py-1 rounded-full hover:bg-blue-200 transition-colors">‚ú® O que fazer?</button>
                 </div>
                 <div id="incidents-list">
                     ${
                       (service.incidents || []).length > 0
                         ? service.incidents
                             .map(
                               (i) =>
                                 `<div class="border-l-4 ${statusMap[
                                   i.status === "Em andamento" ||
                                   i.status === "Agendada"
                                     ? "MAINTENANCE"
                                     : "MAJOR_OUTAGE"
                                 ].color.replace(
                                   "bg-",
                                   "border-"
                                 )} pl-3 py-1"><p class="font-semibold text-slate-800">${
                                   i.title
                                 }</p><p class="text-slate-500">${i.status} - ${
                                   i.time
                                 }</p></div>`
                             )
                             .join("")
                         : '<p class="text-slate-500 text-sm">Nenhum incidente ativo.</p>'
                     }
                 </div>
                 <div id="troubleshoot-result" class="mt-4 text-sm bg-blue-50 border-l-4 border-blue-400 p-3 rounded-r-lg" style="display: none;"></div>
            </div>
            <div>
                <h3 class="font-semibold text-slate-800 mb-3">An√°lise de Percep√ß√£o do Usu√°rio</h3>
                <div class="bg-white p-4 rounded-lg border border-slate-200">
                    <div class="chart-container">
                        <canvas id="user-perception-chart"></canvas>
                    </div>
                </div>
            </div>`;

          modalBody.innerHTML = modalHtml;

          renderPerceptionChart(service);

          const troubleshootBtn = document.getElementById("troubleshoot-btn");

          if (service.incidents && service.incidents.length > 0) {
            troubleshootBtn.style.display = "block";
            troubleshootBtn.addEventListener("click", async () => {
              troubleshootBtn.disabled = true;
              const troubleshootResult = document.getElementById(
                "troubleshoot-result"
              );
              troubleshootResult.style.display = "block";
              troubleshootResult.innerHTML = `<p class="animate-pulse-fast">‚ú® Gerando sugest√µes com IA...</p>`;

              const incidents = service.incidents
                .map((i) => `${i.title} (${i.status})`)
                .join(", ");
              const prompt = `O servi√ßo ${service.name} est√° com o seguinte problema: "${incidents}". Forne√ßa uma lista de 3 a 4 passos pr√°ticos e simples que um usu√°rio no Brasil pode seguir para tentar contornar ou diagnosticar o problema. A resposta deve ser em portugu√™s e formatada como uma lista de itens.`;
              const suggestions = await callGemini(prompt);
              troubleshootResult.innerHTML = suggestions.replace(/\n/g, "<br>");
              troubleshootBtn.disabled = false;
            });
          } else {
            troubleshootBtn.style.display = "none";
          }

          modal.classList.remove("invisible", "opacity-0");
        }

        function renderPerceptionChart(service) {
          if (perceptionChart) perceptionChart.destroy();
          const ctx = document
            .getElementById("user-perception-chart")
            .getContext("2d");
          const labels = Array.from(
            { length: 12 },
            (_, i) => `${(new Date().getHours() - 11 + i + 24) % 24}:00`
          );
          const dataPoints = Array.from(
            { length: 11 },
            () => Math.random() * service.userPerception.baseline * 0.8
          );
          dataPoints.push(service.userPerception.reports);
          perceptionChart = new Chart(
            ctx,
            getChartConfig(labels, dataPoints, "Relatos de Usu√°rios")
          );
        }

        function runSimulatedSpeedTest() {
          runSpeedTestBtn.disabled = true;
          btnText.textContent = "Testando...";
          [pingResultValue, downloadResultValue, uploadResultValue].forEach(
            (el) => {
              el.textContent = "--";
              el.classList.add("animate-pulse-fast");
            }
          );

          const targetPing = 4 + Math.floor(Math.random() * 10);
          const targetDownload = 650 + Math.floor(Math.random() * 100);
          const targetUpload = 140 + Math.floor(Math.random() * 20);
          const duration = 2500;

          setTimeout(() => {
            pingResultValue.textContent = targetPing;
            pingResultValue.classList.remove("animate-pulse-fast");
          }, 500);

          setTimeout(() => {
            downloadResultValue.textContent = targetDownload.toFixed(2);
            downloadResultValue.classList.remove("animate-pulse-fast");
          }, 1500);

          setTimeout(() => {
            uploadResultValue.textContent = targetUpload.toFixed(2);
            uploadResultValue.classList.remove("animate-pulse-fast");
            runSpeedTestBtn.disabled = false;
            btnText.textContent = "Testar Novamente";
          }, 2500);

          const frames = 50;
          const initialData = speedChart
            ? speedChart.data.datasets[0].data.slice(-20)
            : [];
          for (let i = 0; i <= frames; i++) {
            setTimeout(() => {
              const progress = i / frames;
              const easeOutProgress = 1 - Math.pow(1 - progress, 3);
              const currentDownload = easeOutProgress * targetDownload;

              if (speedChart) {
                const newData = initialData.concat(
                  Array(i + 1)
                    .fill(0)
                    .map((_, j) => (j / i) * currentDownload)
                );
                if (newData.length > 20) newData.shift();
                speedChart.data.datasets[0].data = newData;
                speedChart.update("none");
              }
            }, (i * duration) / frames);
          }
        }

        function initSpeedChart() {
          if (speedChart) speedChart.destroy();
          const ctx = document.getElementById("speed-chart").getContext("2d");
          speedChart = new Chart(
            ctx,
            getChartConfig(Array(20).fill(""), [], "Velocidade (Mb/s)", true)
          );
        }

        function getChartConfig(labels, data, label, isSpeedChart = false) {
          const gridColor = "#e2e8f0";
          const pointColor = "#3b82f6";
          const borderColor = "#60a5fa";
          const gradientStart = "rgba(96, 165, 250, 0.3)";
          const gradientEnd = "rgba(96, 165, 250, 0)";

          return {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: label,
                  data: data,
                  fill: true,
                  backgroundColor: (ctx) => {
                    const gradient = ctx.chart.ctx.createLinearGradient(
                      0,
                      0,
                      0,
                      ctx.chart.height
                    );
                    gradient.addColorStop(0, gradientStart);
                    gradient.addColorStop(1, gradientEnd);
                    return gradient;
                  },
                  borderColor: borderColor,
                  pointBackgroundColor: pointColor,
                  tension: 0.4,
                  pointRadius: 0,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: { legend: { display: false } },
              scales: {
                y: { beginAtZero: true, grid: { color: gridColor } },
                x: { display: false },
              },
              interaction: { intersect: false, mode: "index" },
            },
          };
        }

        function closeModal() {
          modal.classList.add("invisible", "opacity-0");
        }
        function updateTimestamp() {
          const now = new Date();
          const dateOptions = {
            day: "2-digit",
            month: "2-digit",
            year: "numeric",
          };
          const timeOptions = {
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
            hour12: false,
          };

          currentDateEl.textContent = now.toLocaleDateString(
            "pt-BR",
            dateOptions
          );
          currentTimeEl.textContent = now.toLocaleTimeString(
            "pt-BR",
            timeOptions
          );
          lastUpdatedSpan.textContent = now.toLocaleTimeString("pt-BR");
        }

        closeModalBtn.addEventListener("click", closeModal);
        modal.addEventListener(
          "click",
          (e) => e.target === modal && closeModal()
        );
        document.addEventListener(
          "keydown",
          (e) =>
            e.key === "Escape" &&
            !modal.classList.contains("invisible") &&
            closeModal()
        );
        runSpeedTestBtn.addEventListener("click", runSimulatedSpeedTest);

        const fiveMinutes = 5 * 60;
        let speedTestCountdown = fiveMinutes;
        const speedTestInterval = setInterval(() => {
          speedTestCountdown--;
          if (speedTestCountdown <= 0) {
            speedTestCountdown = fiveMinutes;
            runSimulatedSpeedTest();
          }
          const minutes = Math.floor(speedTestCountdown / 60);
          const seconds = speedTestCountdown % 60;
          countdownContainer.textContent = `Pr√≥ximo teste em: ${minutes}m ${seconds
            .toString()
            .padStart(2, "0")}s`;
        }, 1000);

        setInterval(() => {
          mockServiceData.forEach((service) => {
            if (
              service.type !== "local_device" &&
              service.officialStatus === "UNKNOWN"
            ) {
              probeService(service.id);
            }
          });
        }, 60000);

        renderDashboard();
        initSpeedChart();
        runSimulatedSpeedTest();
        updateTimestamp();
        setInterval(updateTimestamp, 1000);
      });
    </script>
  </body>
</html>

